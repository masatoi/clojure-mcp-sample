* Clojure + Clojure-MCP + Claude Code手順

** 最小構成でプロジェクト作成

#+begin_src
mkdir myapp && cd myapp
cat > deps.edn <<'EDN'
{:paths ["src"]
 :aliases {}}
EDN
mkdir -p src/myapp
cat > src/myapp/core.clj <<'CLJ'
(ns myapp.core)
(defn -main [] (println "hello"))
CLJ
#+end_src

** 開発するプロジェクト側でnREPLサーバを起動する

#+begin_src 
$ clojure -M:nrepl
nREPL server started on port 7888 on host localhost - nrepl://localhost:7888
#+end_src

** Clojureコマンドの設定にMCPサーバの設定を入れる

~/.clojure/deps.edn
#+begin_src clojure
{:aliases
 {:mcp
  {:deps {org.slf4j/slf4j-nop {:mvn/version "2.0.16"} ;; stdio用
          com.bhauman/clojure-mcp {:git/url "https://github.com/bhauman/clojure-mcp.git"
                                   :git/tag "v0.1.8-alpha"
                                   :git/sha "457f197"}}
   :exec-fn clojure-mcp.main/start-mcp-server
   :exec-args {:port 7888}}}}
#+end_src

MCPサーバ起動テスト

#+begin_src 
clojure -X:mcp :port 7888
#+end_src

** Claude Code側の設定

MCPサーバ起動テストに使ったコマンドを設定する

#+begin_src 
claude mcp add clojure-mcp -- clojure -X:mcp :port 7888
#+end_src

claude で起動して /mcp コマンドで接続確認

#+begin_src 
 Manage MCP servers
│
│ ❯ 1. clojure-mcp  ✔ connected · Enter to view details
│
│ MCP Config locations (by scope):
│  • User config (available in all your projects):
│    • /home/wiz/.claude.json
│  • Project config (shared via .mcp.json):
│    • /home/wiz/clj/myapp/.mcp.json (file does not exist)
│  • Local config (private to you in this project):
│    • /home/wiz/.claude.json [project: /home/wiz/clj/myapp]
#+end_src

** テスト実行

特定のテストファイルのみ実行:
#+begin_src
clojure -M -e "(require '[clojure.test :as test]) (require '[myapp.core-test]) (test/run-tests 'myapp.core-test)"
#+end_src

全テストファイルを実行:
#+begin_src
clojure -M -e "(require '[clojure.test :as test]) (require '[myapp.core-test]) (test/run-all-tests #\".*-test$\")"
#+end_src
